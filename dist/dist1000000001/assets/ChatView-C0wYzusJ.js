import{_ as B,r as f,b as L,C as M,v as $,c as s,i as c,f as R,w as C,F as Y,h as I,a as k,e as U,L as F,j as v,o as a,t as m,B as H,g as T,k as N,l as O}from"./index-DpYZfZlD.js";import{l as K}from"./index-TjCxX7sJ.js";import{A as _}from"./index-BHndqmlX.js";import{h as E}from"./moment-C5S46NFB.js";const j={class:"chat-box-contact"},J={key:0,class:"float-right"},q={key:1},z={__name:"ChatView",setup(G){const A=N(),S=O(),h=K("http://localhost:3003"),u=f([]),i=f(""),l=f(null),p=f([]),g=f(!1);h.on("chat message official",o=>{const{to_uuid:t,from_name:e,to_name:d}=o;_.USER.NAME().then(r=>{console.log("res.name",r,e,d),r.name===d&&u.value.push({...o,positon:"left"})})}),h.on("chat message official self",o=>{const{to_uuid:t,from_name:e,to_name:d}=o;_.USER.NAME().then(r=>{console.log("res.name",r,e,d),u.value.push({...o,positon:"left",self:o.sender_name===r.name}),l.value.scrollTop=l.value.scrollHeight})});const w=()=>{i.value&&_.USER.NAME().then(o=>{console.log("newMessage.value",i.value),h.emit("chat message official",{sender_name:o.name,from_uuid:"user",to_uuid:"",content:i.value,token:localStorage.getItem("token")}),i.value=""})},y=o=>{console.log("item",o),S.push(`/chat/${o.active_uuid}`)},x=()=>{_.CHAT.LIST_OFFICIAL().then(o=>{console.log("res",o),_.USER.NAME().then(t=>{g.value=decodeURIComponent(t.name)==="在线客服",u.value=o.map(e=>({...e,active_name:(t.name===e.to_name,e.from_name),positon:t.name===e.to_name?"left":"right",self:t.name===e.from_name})),console.log("messages",u)})})},D=()=>{_.CHAT.CONTACT_LIST({shop_uuid:A.params.shop_uuid}).then(o=>{console.log("res",o),_.USER.NAME().then(t=>{console.log("resName",t),console.log("contact.value",p.value),p.value=o.map(e=>(console.log("item",decodeURIComponent(e.from_name),decodeURIComponent(e.to_name),decodeURIComponent(t.name)),{...e,active_name:(t.name===e.to_name,e.from_name),is_self:t.name===e.from_name,active_uuid:(t.name===e.to_name,e.from_uuid),positon:t.name===e.to_name?"left":"right"})),console.log("contact.value",p.value),console.log("messages",u)})})};return L(()=>{x(),D(),M(()=>{l.value.scrollTop=l.value.scrollHeight+200}),$(()=>u.value,()=>{console.log("1",l.value.scrollTop,l.value.scrollHeight),M(()=>{l.value.scrollTop=l.value.scrollHeight+200})})}),(o,t)=>{const e=v("el-button"),d=v("el-col"),r=v("el-row"),V=v("el-input");return a(),s("div",null,[c("div",null,[c("div",j,[R(r,null,{default:C(()=>[(a(!0),s(Y,null,I(p.value,(n,b)=>(a(),s("div",null,[n.is_self?k("",!0):(a(),U(d,{key:b,class:"chat-box-line contact",span:2},{default:C(()=>[R(e,{onClick:P=>y(n)},{default:C(()=>[c("strong",null,m(decodeURIComponent(n.active_name)),1)]),_:2},1032,["onClick"])]),_:2},1024))]))),256))]),_:1})]),g.value?k("",!0):(a(),s("div",{key:0,class:"chat-box",ref_key:"chatBox",ref:l},[(a(!0),s(Y,null,I(u.value,n=>(a(),s("div",{key:n.id,class:"chat-box-line"},[n.self?(a(),s("div",J,[c("p",null,m(H(E)(n.create_time).format({cn:"YYYY年MM月DD日 HH时mm分ss秒",en:"MM/DD/YYYY HH:mm:ss"}[o.$store.state.lang])),1),c("strong",null,m(decodeURIComponent(n.active_name))+":",1),T(" "+m(decodeURIComponent(n.content)),1)])):(a(),s("div",q,[c("p",null,m(H(E)(n.create_time).format({cn:"YYYY年MM月DD日 HH时mm分ss秒",en:"MM/DD/YYYY HH:mm:ss"}[o.$store.state.lang])),1),c("strong",null,m(decodeURIComponent(n.active_name))+":",1),T(" "+m(decodeURIComponent(n.content)),1)])),t[1]||(t[1]=c("div",{class:"clear-botn"},null,-1))]))),128))],512))]),o.$store.state.token&&!g.value?(a(),U(V,{key:0,class:"chat-input",modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=n=>i.value=n),onKeyup:F(w,["enter"]),placeholder:"输入消息并按Enter发送"},null,8,["modelValue"])):k("",!0)])}}},ee=B(z,[["__scopeId","data-v-63451c39"]]);export{ee as default};
