import{_ as j,r as C,C as h,b as K,v as O,c as y,i as _,f as P,w as z,T as J,e as Q,L as W,a as X,j as Z,o as g,F as b,h as ee,t as x,B as E,g as I,k as oe}from"./index-DpYZfZlD.js";import{l as ae}from"./index-TjCxX7sJ.js";import{h as A}from"./moment-C5S46NFB.js";import{A as T}from"./index-BHndqmlX.js";var w={exports:{}},D;function G(){if(D)return w.exports;D=1;var i=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(i){var c=new Uint8Array(16);w.exports=function(){return i(c),c}}else{var u=new Array(16);w.exports=function(){for(var t=0,e;t<16;t++)t&3||(e=Math.random()*4294967296),u[t]=e>>>((t&3)<<3)&255;return u}}return w.exports}var M,N;function $(){if(N)return M;N=1;for(var i=[],c=0;c<256;++c)i[c]=(c+256).toString(16).substr(1);function u(o,t){var e=t||0,l=i;return[l[o[e++]],l[o[e++]],l[o[e++]],l[o[e++]],"-",l[o[e++]],l[o[e++]],"-",l[o[e++]],l[o[e++]],"-",l[o[e++]],l[o[e++]],"-",l[o[e++]],l[o[e++]],l[o[e++]],l[o[e++]],l[o[e++]],l[o[e++]]].join("")}return M=u,M}var V,B;function re(){if(B)return V;B=1;var i=G(),c=$(),u,o,t=0,e=0;function l(s,a,f){var r=a&&f||0,n=a||[];s=s||{};var v=s.node||u,d=s.clockseq!==void 0?s.clockseq:o;if(v==null||d==null){var m=i();v==null&&(v=u=[m[0]|1,m[1],m[2],m[3],m[4],m[5]]),d==null&&(d=o=(m[6]<<8|m[7])&16383)}var p=s.msecs!==void 0?s.msecs:new Date().getTime(),R=s.nsecs!==void 0?s.nsecs:e+1,S=p-t+(R-e)/1e4;if(S<0&&s.clockseq===void 0&&(d=d+1&16383),(S<0||p>t)&&s.nsecs===void 0&&(R=0),R>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");t=p,e=R,o=d,p+=122192928e5;var k=((p&268435455)*1e4+R)%4294967296;n[r++]=k>>>24&255,n[r++]=k>>>16&255,n[r++]=k>>>8&255,n[r++]=k&255;var H=p/4294967296*1e4&268435455;n[r++]=H>>>8&255,n[r++]=H&255,n[r++]=H>>>24&15|16,n[r++]=H>>>16&255,n[r++]=d>>>8|128,n[r++]=d&255;for(var U=0;U<6;++U)n[r+U]=v[U];return a||c(n)}return V=l,V}var Y,F;function ne(){if(F)return Y;F=1;var i=G(),c=$();function u(o,t,e){var l=t&&e||0;typeof o=="string"&&(t=o==="binary"?new Array(16):null,o=null),o=o||{};var s=o.random||(o.rng||i)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,t)for(var a=0;a<16;++a)t[l+a]=s[a];return t||c(s)}return Y=u,Y}var q,L;function te(){if(L)return q;L=1;var i=re(),c=ne(),u=c;return u.v1=i,u.v4=c,q=u,q}var le=te();const se={key:0,class:"float-right"},ue={key:1},ce={__name:"ChatForShopView",setup(i){const c=oe(),u=ae("http://localhost:3003"),o=C([]),t=C(""),e=C(null);u.on("chat message shop",a=>{const{to_uuid:f,from_name:r,to_name:n}=a;T.USER.NAME().then(v=>{console.log("res.name shop",v,r,n,a),v.name===n&&(o.value.push({...a,positon:"left"}),h(()=>{e.value.scrollTop=e.value.scrollHeight+200,h(()=>{e.value.scrollTop=e.value.scrollHeight+200})}))})}),u.on("chat message shop self auto",a=>{console.log("chat message shop self auto",a),u.emit("chat message shop",a)}),u.on("chat message shop self",a=>{const{to_uuid:f,from_name:r,to_name:n}=a;T.USER.NAME().then(v=>{console.log("res.name self",v,r,n,a),o.value.push({...a,positon:"left",self:a.sender_name===v.name}),h(()=>{e.value.scrollTop=e.value.scrollHeight+200,h(()=>{e.value.scrollTop=e.value.scrollHeight+200})})})});const l=()=>{t.value&&T.USER.NAME().then(a=>{const f=le.v4();console.log("resName.name",a.name),u.emit("chat message shop",{uuid:f,sender_name:a.name,from_uuid:"user",to_uuid:"",shop_uuid:c.params.shop_uuid,content:t.value,token:localStorage.getItem("token")}),t.value=""})},s=()=>{T.CHAT.LIST_SHOP({shop_uuid:c.params.shop_uuid}).then(a=>{console.log("res",a),T.USER.NAME().then(f=>{o.value=a.map(r=>(console.log("item",decodeURIComponent(r.from_name),decodeURIComponent(r.to_name),decodeURIComponent(f.name)),{...r,active_name:(f.name===r.from_name,r.from_name),active_uuid:f.name===r.to_name?r.from_uuid:r.to_uuid,positon:f.name===r.to_name?"left":"right",self:f.name===r.from_name})),console.log("resName.name",f.name),console.log("messages.value",o.value),h(()=>{e.value.scrollTop=e.value.scrollHeight+200,h(()=>{e.value.scrollTop=e.value.scrollHeight+200})}),console.log("messages",o)})})};return K(()=>{s(),h(()=>{console.log("2",e.value.scrollTop,e.value.scrollHeight),e.value.scrollTop=e.value.scrollHeight+200}),O(()=>o.value,()=>{console.log("1",e.value.scrollTop,e.value.scrollHeight),h(()=>{e.value.scrollTop=e.value.scrollHeight+200})})}),(a,f)=>{const r=Z("el-input");return g(),y("div",null,[_("div",{class:"chat-box",ref_key:"chatBox",ref:e},[P(J,{name:"message",tag:"div"},{default:z(()=>[(g(!0),y(b,null,ee(o.value,n=>(g(),y("div",{key:n.id,class:"chat-box-line"},[n.self?(g(),y("div",se,[_("p",null,x(E(A)(n.create_time).format({cn:"YYYY年MM月DD日 HH时mm分ss秒",en:"MM/DD/YYYY HH:mm:ss"}[a.$store.state.lang])),1),_("strong",null,x(decodeURIComponent(n.active_name))+":",1),I(" "+x(decodeURIComponent(n.content)),1)])):(g(),y("div",ue,[_("p",null,x(E(A)(n.create_time).format({cn:"YYYY年MM月DD日 HH时mm分ss秒",en:"MM/DD/YYYY HH:mm:ss"}[a.$store.state.lang])),1),_("strong",null,x(decodeURIComponent(n.active_name))+":",1),I(" "+x(decodeURIComponent(n.content)),1)])),f[1]||(f[1]=_("div",{class:"clear-botn"},null,-1))]))),128))]),_:1})],512),a.$store.state.token?(g(),Q(r,{key:0,class:"chat-input",modelValue:t.value,"onUpdate:modelValue":f[0]||(f[0]=n=>t.value=n),onKeyup:W(l,["enter"]),placeholder:"输入消息并按Enter发送"},null,8,["modelValue"])):X("",!0)])}}},me=j(ce,[["__scopeId","data-v-be742998"]]);export{me as default};
